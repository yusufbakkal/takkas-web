<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emlak Detay - TAKKAS</title>
    
    <!-- CSS Bağlantıları -->
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/header.css">
    <link rel="stylesheet" href="assets/css/navbar.css">
    <link rel="stylesheet" href="assets/css/property-detail.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header Bileşeni -->
    <div id="header-component"></div>

    <!-- Navbar Bileşeni -->
    <div id="navbar-component"></div>

    <!-- Ana İçerik -->
    <main class="property-detail-container">
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner"></div>
        </div>

        <div class="property-detail-content" id="propertyDetailContent" style="display: none;">
            <!-- İlan Başlığı ve Konum -->
            <div class="property-header">
                <h1 id="propertyTitle">İlan Yükleniyor...</h1>
                <div class="property-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="propertyLocation">Konum Yükleniyor...</span>
                </div>
            </div>

            <!-- İlan Görselleri ve Detayları -->
            <div class="property-main-content">
                <!-- Sol Taraf - Görseller -->
                <div class="property-images-container">
                    <div class="property-main-image">
                        <img id="mainPropertyImage" src="https://via.placeholder.com/800x600/e0e0e0/333333?text=Emlak+G%C3%B6rseli" alt="Emlak Görseli">
                        <div class="image-counter">
                            <span id="currentImageIndex">1</span>/<span id="totalImages">5</span>
                        </div>
                        <button class="image-nav prev-image" id="prevImage">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="image-nav next-image" id="nextImage">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="property-thumbnails" id="propertyThumbnails">
                        <!-- Küçük resimler JavaScript ile eklenecek -->
                    </div>
                </div>

                <!-- Sağ Taraf - Fiyat ve İletişim -->
                <div class="property-sidebar">
                    <div class="property-price-section">
                        <div class="price-header">
                            <span class="price-label">Fiyat</span>
                            <button class="favorite-button" id="favoriteButton">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                        <div class="price-amount" id="propertyPrice">0 TL</div>
                    </div>

                    <div class="seller-info">
                        <div class="seller-header">
                            <div class="seller-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="seller-details">
                                <h3 id="sellerName">Satıcı Adı</h3>
                                <p class="seller-type" id="sellerType">Bireysel Üye</p>
                            </div>
                        </div>
                        <button class="contact-button phone-button">
                            <i class="fas fa-phone-alt"></i>
                            <span>Telefonu göster</span>
                        </button>
                        <button class="contact-button message-button">
                            <i class="fas fa-envelope"></i>
                            <span>Mesaj Gönder</span>
                        </button>
                    </div>

                    <div class="warning-box">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Güvenliğiniz için kapora göndermeyiniz ya da benzeri hiçbir ön ödeme yapmayınız.</p>
                        <a href="#" class="details-link">Detaylı bilgi <i class="fas fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>

            <!-- İlan Detayları -->
            <div class="property-details-section">
                <h2 class="section-title">İlan Detayları</h2>
                <div class="property-details-grid">
                    <div class="detail-item">
                        <span class="detail-label">İlan No</span>
                        <span class="detail-value" id="listingId">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">İlan Tarihi</span>
                        <span class="detail-value" id="listingDate">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Emlak Tipi</span>
                        <span class="detail-value" id="estateType">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Brüt m²</span>
                        <span class="detail-value" id="grossArea">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Net m²</span>
                        <span class="detail-value" id="netArea">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Oda Sayısı</span>
                        <span class="detail-value" id="roomNumber">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Bina Yaşı</span>
                        <span class="detail-value" id="buildingAge">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Bulunduğu Kat</span>
                        <span class="detail-value" id="locatedFloor">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Kat Sayısı</span>
                        <span class="detail-value" id="totalFloor">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Isıtma</span>
                        <span class="detail-value" id="heating">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Banyo Sayısı</span>
                        <span class="detail-value" id="bathNumber">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Balkon</span>
                        <span class="detail-value" id="balcony">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Asansör</span>
                        <span class="detail-value" id="lift">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Otopark</span>
                        <span class="detail-value" id="parking">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Eşyalı</span>
                        <span class="detail-value" id="furnished">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Kullanım Durumu</span>
                        <span class="detail-value" id="usingStatus">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Site İçerisinde</span>
                        <span class="detail-value" id="onSite">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Site Adı</span>
                        <span class="detail-value" id="siteName">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Aidat</span>
                        <span class="detail-value" id="dues">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Tapu Durumu</span>
                        <span class="detail-value" id="deedStatus">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">İmar Durumu</span>
                        <span class="detail-value" id="zoningStatus">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">m² Birim Fiyatı</span>
                        <span class="detail-value" id="squareMeterPrice">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Krediye Uygun</span>
                        <span class="detail-value" id="creditStatus">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Kimden</span>
                        <span class="detail-value" id="fromWhere">-</span>
                    </div>
                </div>
            </div>

            <!-- İlan Açıklaması -->
            <div class="property-description-section">
                <h2 class="section-title">İlan Açıklaması</h2>
                <div class="property-description" id="propertyDescription">
                    <p>Açıklama yükleniyor...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // Bileşenleri yükle
        fetch('components/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-component').innerHTML = data;
            });

        fetch('components/navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar-component').innerHTML = data;
            });

        // URL'den ilan ID'sini al
        function getPropertyIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Tarih formatını düzenle
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Boolean değerleri Evet/Hayır olarak göster
        function formatBoolean(value) {
            return value ? 'Evet' : 'Hayır';
        }

        // Fiyat formatını düzenle
        function formatPrice(price) {
            return parseFloat(price).toLocaleString('tr-TR') + ' TL';
        }

        // Emlak detaylarını göster
        function displayPropertyDetails(property) {
            // Başlık ve konum
            document.getElementById('propertyTitle').textContent = property.title;
            document.getElementById('propertyLocation').textContent = 'Adana, Türkiye'; // API'den adres bilgisi gelecek

            // Fiyat
            document.getElementById('propertyPrice').textContent = formatPrice(property.price);

            // Satıcı bilgileri
            document.getElementById('sellerName').textContent = 'Emlak Sahibi'; // API'den satıcı bilgisi gelecek
            document.getElementById('sellerType').textContent = property.from_where;

            // İlan detayları
            document.getElementById('listingId').textContent = property.id;
            document.getElementById('listingDate').textContent = formatDate(property.created_at);
            document.getElementById('estateType').textContent = property.estate_type.charAt(0).toUpperCase() + property.estate_type.slice(1);
            document.getElementById('grossArea').textContent = property.square_meters_gross + ' m²';
            document.getElementById('netArea').textContent = property.square_meters_net + ' m²';
            document.getElementById('roomNumber').textContent = property.room_number;
            document.getElementById('buildingAge').textContent = property.building_age;
            document.getElementById('locatedFloor').textContent = property.located_floor;
            document.getElementById('totalFloor').textContent = property.total_floor;
            document.getElementById('heating').textContent = property.heating;
            document.getElementById('bathNumber').textContent = property.bath_number;
            document.getElementById('balcony').textContent = formatBoolean(property.balcony);
            document.getElementById('lift').textContent = formatBoolean(property.lift);
            document.getElementById('parking').textContent = formatBoolean(property.parking);
            document.getElementById('furnished').textContent = formatBoolean(property.furnished);
            document.getElementById('usingStatus').textContent = property.using_status;
            document.getElementById('onSite').textContent = formatBoolean(property.on_site);
            document.getElementById('siteName').textContent = property.site_name || '-';
            document.getElementById('dues').textContent = property.dues ? formatPrice(property.dues) : '-';
            document.getElementById('deedStatus').textContent = property.deed_status;
            document.getElementById('zoningStatus').textContent = property.zoning_status;
            document.getElementById('squareMeterPrice').textContent = property.square_meters_price ? formatPrice(property.square_meters_price) : '-';
            document.getElementById('creditStatus').textContent = formatBoolean(property.credit_status);
            document.getElementById('fromWhere').textContent = property.from_where;

            // İlan açıklaması
            document.getElementById('propertyDescription').innerHTML = `<p>${property.description}</p>`;

            // Görseller için placeholder oluştur
            createImageGallery();

            // İçeriği göster
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('propertyDetailContent').style.display = 'block';
        }

        // Görsel galerisi oluştur
        function createImageGallery() {
            const thumbnailsContainer = document.getElementById('propertyThumbnails');
            thumbnailsContainer.innerHTML = '';

            // 5 adet placeholder görsel oluştur
            for (let i = 1; i <= 5; i++) {
                const thumbnail = document.createElement('div');
                thumbnail.className = 'property-thumbnail';
                if (i === 1) thumbnail.classList.add('active');

                const img = document.createElement('img');
                img.src = `https://via.placeholder.com/150x100/e0e0e0/333333?text=Görsel+${i}`;
                img.alt = `Emlak Görseli ${i}`;
                img.dataset.index = i;

                thumbnail.appendChild(img);
                thumbnailsContainer.appendChild(thumbnail);

                // Küçük resme tıklandığında ana görseli değiştir
                thumbnail.addEventListener('click', function() {
                    document.querySelectorAll('.property-thumbnail').forEach(thumb => thumb.classList.remove('active'));
                    this.classList.add('active');
                    
                    const index = img.dataset.index;
                    document.getElementById('mainPropertyImage').src = `https://via.placeholder.com/800x600/e0e0e0/333333?text=Emlak+G%C3%B6rseli+${index}`;
                    document.getElementById('currentImageIndex').textContent = index;
                });
            }

            // Toplam görsel sayısını güncelle
            document.getElementById('totalImages').textContent = '5';

            // Önceki ve sonraki görsel butonları
            document.getElementById('prevImage').addEventListener('click', function() {
                navigateImages('prev');
            });

            document.getElementById('nextImage').addEventListener('click', function() {
                navigateImages('next');
            });
        }

        // Görseller arasında gezinme
        function navigateImages(direction) {
            const currentIndex = parseInt(document.getElementById('currentImageIndex').textContent);
            const totalImages = parseInt(document.getElementById('totalImages').textContent);
            
            let newIndex;
            if (direction === 'prev') {
                newIndex = currentIndex > 1 ? currentIndex - 1 : totalImages;
            } else {
                newIndex = currentIndex < totalImages ? currentIndex + 1 : 1;
            }
            
            document.getElementById('currentImageIndex').textContent = newIndex;
            document.getElementById('mainPropertyImage').src = `https://via.placeholder.com/800x600/e0e0e0/333333?text=Emlak+G%C3%B6rseli+${newIndex}`;
            
            // Küçük resimlerdeki aktif sınıfını güncelle
            document.querySelectorAll('.property-thumbnail').forEach(thumb => thumb.classList.remove('active'));
            document.querySelectorAll('.property-thumbnail img')[newIndex - 1].parentElement.classList.add('active');
        }

        // Favoriye ekleme/çıkarma
        document.getElementById('favoriteButton').addEventListener('click', function() {
            const icon = this.querySelector('i');
            icon.classList.toggle('far');
            icon.classList.toggle('fas');
            icon.classList.toggle('favorited');
        });

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', async function() {
            const propertyId = getPropertyIdFromUrl();
            
            if (!propertyId) {
                alert('İlan ID bulunamadı!');
                return;
            }
            
            try {
                // API'den emlak detaylarını çek
                const response = await fetch(`https://takkas-api.onrender.com/api/estates/${propertyId}`);
                
                if (!response.ok) {
                    throw new Error(`API isteği başarısız oldu: ${response.status} ${response.statusText}`);
                }
                
                const property = await response.json();
                displayPropertyDetails(property);
            } catch (error) {
                console.error('Emlak detayları yüklenirken hata oluştu:', error);
                
                // Hata durumunda örnek veri göster
                const dummyProperty = {
                    id: 3,
                    estate_type: "villa",
                    title: "Baraka",
                    description: "Muhteşem deniz manzaralı, yeni yapılmış lüks daire. Fiyat güncellendi.",
                    price: "153700.00",
                    created_at: "2025-03-06T15:48:34.514Z",
                    square_meters_gross: "150.00",
                    square_meters_net: "135.00",
                    room_number: "8+1",
                    building_age: 0,
                    located_floor: 5,
                    total_floor: 12,
                    heating: "Doğalgaz",
                    bath_number: 2,
                    balcony: true,
                    lift: true,
                    parking: true,
                    furnished: false,
                    using_status: "Boş",
                    on_site: true,
                    site_name: "Deniz Panorama Evleri",
                    dues: "500.00",
                    deed_status: "Kat Mülkiyetli",
                    zoning_status: "Konut",
                    square_meters_price: "5000.00",
                    ada_no: null,
                    parsel_no: null,
                    pafta_no: null,
                    kaks: null,
                    gabari: null,
                    credit_status: true,
                    from_where: "Emlakçı",
                    user_id: 5,
                    address_id: 1,
                    category_id: 20
                };
                
                displayPropertyDetails(dummyProperty);
            }
        });
    </script>
</body>
</html> 